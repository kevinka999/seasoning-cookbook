---
alwaysApply: true
---

# Seasoning Cookbook - Especificação do Sistema

## Visão Geral

O **Seasoning Cookbook** é uma aplicação web que permite aos usuários criar, compartilhar e descobrir receitas de "seasoning" (temperos) para aumentar as chances de capturar ou atrair Pokémons específicos em um jogo.

## Funcionalidades Principais

### 1. Sistema de Autenticação

- **Identity Service Desacoplado**: Autenticação gerenciada por sistema externo
- O Identity Service é responsável por:
  - Login com Google OAuth
  - Login com email/senha
  - Gerenciamento de tokens JWT
  - Informações de perfil (email, nome, foto, etc.)
- **Fluxo de Cadastro no Seasoning Cookbook**:
  1. Cliente autentica no Identity Service
  2. Cliente acessa o Seasoning Cookbook com token válido
  3. Sistema verifica se usuário existe no nosso banco de dados
  4. Se não existir, usuário é redirecionado para cadastro de informações específicas do app
  5. Usuário cadastra nickname (obrigatório) e in-game nickname (opcional)
- Usuários possuem nickname e in-game nickname (opcional) armazenados localmente

### 2. Sistema de Receitas

- Usuários podem criar receitas recomendando combinações de seasoning items
- Cada receita é composta por:
  - **3 Seasoning Items** (temperos/itens do jogo)
  - **1 Pokemon alvo** (o Pokemon que a receita ajuda a atrair/capturar)
  - **Descrição opcional** (texto explicativo do autor)

### 3. Sistema de Upvote e Ranking

- Usuários podem dar upvote em receitas que funcionaram bem
- Sistema de ranking baseado em quantidade de upvotes
- Receitas mais votadas aparecem primeiro nas buscas
- Prevenção de upvotes duplicados (mesmo usuário não pode votar duas vezes)

### 4. Busca e Descoberta

- Buscar receitas por Pokemon específico
- Visualizar receitas mais votadas (ranking geral)

## Entidades do Domínio

### User (Usuário)

- **ID**: Referência ao ID do Identity Service (usado como chave primária)
- **Informações Locais**: nickname (obrigatório), inGameNickname (opcional)
- **Metadados**: createdAt, updatedAt
- **Nota**: Autenticação e informações de perfil (email, nome, foto) são gerenciadas pelo Identity Service desacoplado

### Recipe (Receita)

- Relacionamentos: authorId (criador), pokemonId (alvo), seasoningItemIds (3 itens)
- Conteúdo: description (opcional)
- Sistema social: upvoteCount, upvotedBy (array de IDs)
- Metadados: createdAt, updatedAt

### Pokemon

- Informações: id, registrationNumber, name, bucket (raridade)
- Características: types (array), eggGroups (array)

### SeasoningItem

- Informações: id, itemName, image (opcional)
- Efeitos: effects (array de ItemEffect)
- Cada efeito tem: type (EffectType), category (opcional), value (opcional)

## Arquitetura Técnica

### Stack

- **Backend**: NestJS
- **Banco de Dados**: MongoDB
- **Arquitetura**: Clean Architecture
- **Autenticação**: Identity Service desacoplado (gerencia Google OAuth, email/senha, JWT)

### Estrutura de Diretórios

```
src/
├── domain/           # Entidades e contratos de repositório
├── application/      # Casos de uso e controllers
└── infrastructure/   # Implementações (MongoDB, etc.)
```

### Otimizações MongoDB

- Índices compostos para queries de ranking eficientes
- Referências por ID (não embedding) para manter dados desnormalizados
- Campo `upvoteCount` separado para performance em queries de ordenação

## Regras de Negócio

1. Cada receita deve ter exatamente 3 seasoning items
2. Usuário não pode dar upvote duplicado na mesma receita
3. Receitas são ordenadas por upvoteCount (desc) e depois por createdAt (desc)
4. Autenticação é gerenciada pelo Identity Service desacoplado
5. Usuário deve estar autenticado no Identity Service antes de acessar funcionalidades do app
6. Usuário deve completar cadastro local (nickname) após primeira autenticação

## Casos de Uso Principais

1. **Cadastrar Usuário Local**: Após autenticação no Identity Service, usuário completa cadastro com nickname e in-game nickname (opcional)
2. **Criar Receita**: Usuário autenticado cria uma receita com 3 seasoning items e 1 Pokemon alvo
3. **Buscar Receitas**: Buscar receitas por Pokemon, por autor, ou ver ranking geral
4. **Dar Upvote**: Usuário autenticado vota em uma receita que funcionou
5. **Visualizar Receita**: Ver detalhes da receita, autor, e quantidade de upvotes
